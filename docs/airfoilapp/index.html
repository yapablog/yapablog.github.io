<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2BSLJEKTVJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2BSLJEKTVJ');
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>翼型計算 | やぱのブログ</title>
    <meta name="description" content="航空工学・生物模倣など" />
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/assets/css/tailwind-output.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200..900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=Zen+Kaku+Gothic+New&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=WDXL+Lubrifont+TC&family=Zen+Kaku+Gothic+New&display=swap"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
  </head>


  <body class="flex flex-col min-h-screen">
    <!--
  開発用ブレイクポイント
  all(mobile):
  sm(min-width: 640px):スマホ横～
  md(min-width: 768px):タブレット
  lg(min-width: 1024px):ノートPC
  xl(min-width: 1280px):大型ディスプレイ
  2xl(min-width: 1536px):超ワイド画面
-->

<header
  class=" top-0 z-50 w-full border-b-2 border-[#624ba1ee] divide-gray-400 py-2 bg-white"
>
  <div
  class="flex flex-col md:flex-row md:items-center md:justify-between w-full"
>
  <a
    href="/"
    class="flex px-2 items-center justify-center md:justify-start mb-2 md:mb-0"
  >
    <img
      class="h-6 md:h-10 w-auto ml-2"
      src="/assets/images/logo.png"
      alt="ロゴ"
    />
    <div class="flex flex-col leading-tigh ">
      <div class="ml-2 text-[1.0rem] md:text-[1.4rem] text-center text-gray-800 font-black">
        やぱのブログ
      </div>
      <div class="ml-2 text-[0rem] md:text-[0.6rem] text-center text-gray-600 font-medium leading-none ">
        航空工学・生物模倣など
      </div>
    </div>
  </a>
  <nav
    class="flex flex-wrap divide-x divide-gray-400 text-center font-semibold text-sm md:text-base md:mr-2"
  >
    <a href="/" class="nav-link">Home</a>
    <a href="/tools/" class="nav-link">Tools</a>
    <a href="/articles/" class="nav-link">Articles</a>
    <a href="/contact/" class="nav-link">Contact</a>
  </nav>
</div>
</header>

    <main class="mx-auto flex-grow w-full">
          <main class="min-h-screen pb-20">
    
    <div class="relative z-10">
      <div class="max-w-7xl mx-auto px-4 pt-10 pb-3 md:px-6 lg:px-8">
          
          <nav class="flex text-xs font-medium text-gray-500 mb-4 uppercase tracking-wider">
            <a href="/" class="hover:text-[var(--color-brand)] transition-colors">Home</a>
            <span class="mx-2">/</span>
            <a href="/tools/" class="hover:text-[var(--color-brand)] transition-colors">Tools</a>
          </nav>

          <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-gray-900 mb-4 font-[family-name:var(--font-sans)]">
            翼型プロパティ計算ツール
          </h1>

          
          <p class="text-sm text-gray-500">
            コード長と点群データから、面積や重心、断面二次モーメントなどの幾何パラメータを計算するWebツールです。
          </p>
          
          
      </div>
    </div>

    <div class="relative z-0">
      <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>

<div class="w-full max-w-7xl mx-auto px-4 py-8">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
    
    <div class="md:col-span-5 space-y-6">
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="bg-[var(--color-primary)] text-white px-5 py-3 border-b border-gray-100">
          <h2 class="text-lg font-bold m-0 text-white" style="border:none; margin:0; padding:0;">パラメータ入力</h2>
        </div>
        
        <div class="p-5">

          <div class="mb-6">
            <label for="chordLength" class="block text-2xl font-bold text-gray-700 mb-1">コード長</label>
            <div class="flex items-center">
              <input type="number" id="chordLength" value="1000" min="0" step="any" class="flex-1 p-2 border border-gray-300 rounded-l focus:ring-2 focus:ring-[var(--color-brand)] focus:outline-none">
              <span class="px-3 py-2 rounded-r text-sm">mm</span>
            </div>
         </div>

          <div class="mb-4">
            <label for="pointCloud" class="block text-2xl font-bold text-gray-700 mb-2">
              点群データ (x y)
            </label>
            <div class="bg-[var(--color-bg-callout)] text-gray-600 text-xs p-3 rounded mb-3 border border-gray-200">
              <p class="font-bold mb-1">点の順序:</p>
              後縁(x=1) → 上面 → 前縁(x=0) → 下面 → 後縁(x=1)<br>
              後縁の隙間可<br>
            </div>
            <textarea 
              id="pointCloud" 
              rows="8" 
              class="w-full font-mono text-sm p-3 border border-gray-300 rounded focus:ring-2 focus:ring-[var(--color-brand)] focus:outline-none"
              placeholder="生成ボタンを押すか、データを貼り付けてください &#10;例&#10;1.0000 0.0000&#10;0.9500 0.0123&#10;..."
            ></textarea>
          </div>
          <div class="mb-5 bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
            <div class="flex justify-between items-end mb-3">
              <label class="block text-sm font-bold text-gray-800">NACA 4桁生成</label>
              <a href="/posts/2025-12-08-nacafoil/" class="text-xs text-[var(--color-brand)] hover:underline flex items-center gap-1 transition-opacity opacity-80 hover:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                アルゴリズム解説
              </a>
            </div>
          
            <div class="flex gap-4 mb-2">
              <div class="flex-1">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-1">4桁コード</label>
                <input type="text" id="nacaCode" maxlength="4" value="4412" class="w-full p-2 bg-white border border-gray-300 rounded text-center font-mono text-sm focus:ring-2 focus:ring-[var(--color-brand)] focus:border-[var(--color-brand)] focus:outline-none transition-shadow" placeholder="4412">
              </div>
              
              <div class="flex-1">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-1">点数</label>
                <input type="number" id="numPoints" value="100" min="20" max="500" class="w-full p-2 bg-white border border-gray-300 rounded text-center font-mono text-sm focus:ring-2 focus:ring-[var(--color-brand)] focus:border-[var(--color-brand)] focus:outline-none transition-shadow">
              </div>
            </div>
          
            <p class="text-[10px] text-gray-400 mb-4 pl-1">例: 0012 (対称), 2412, 4412 (非対称)</p>
          
            <div class="flex items-center justify-evenly pt-3 border-t border-gray-200">

              <div class="flex items-center gap-2">
                <label class="relative inline-block w-11 h-6">
                  <input 
                    type="checkbox" 
                    id="closeTE" 
                    class="peer sr-only" 
                    checked 
                  >
                  <span class="block w-11 h-6 bg-gray-300 rounded-full cursor-pointer transition-colors duration-300 peer-checked:bg-[var(--color-brand)]"></span>
                  <span class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform duration-300 cursor-pointer shadow-sm toggle-knob"></span>
                </label>
                <label for="closeTE" class="text-xs text-gray-700 cursor-pointer select-none">
                  後縁を閉じる
                </label>
              </div>
          
              <button onclick="generateNACA()" class="px-5 py-1.5 w-30 bg-gray-800 text-white text-xs font-bold rounded hover:bg-gray-700 active:scale-95 transition-all shadow-sm">
                生成
              </button>
            </div>
              
            <style>
              /* チェックされたらつまみを右に移動 (サイズに合わせて調整済み) */
              input:checked + span + .toggle-knob {
                transform: translateX(20px);
              }
            </style>
          </div>

          <div class="grid grid-cols-2 gap-3 mb-4">
            <button onclick="normalizeAndUpdate()" class="col-span-2 px-4 py-2 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded hover:bg-amber-100 transition-colors">
              正規化
              <p class="text-xs text-amber-700"> 前縁 x=0, 後縁 x=1, 後縁の中点 = X軸上</p>
            </button>
          </div>

          <button onclick="calculateProperties()" class="w-full py-3 bg-[var(--color-brand)] text-white font-bold rounded shadow hover:opacity-90 transition-opacity">
            計算・描画実行
          </button>
        </div>
      </div>
    </div>

    <div class="md:col-span-7">
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 h-full flex flex-col">
        <div class="bg-gray-50 px-5 py-3 border-b border-gray-200">
          <h5 class="font-bold text-gray-700 m-0 text-base">解析結果 & 形状</h5>
        </div>
        <div class="p-5 flex-1">
          <div id="airfoilPlot" class="w-full h-80 md:h-96 border border-gray-100 rounded mb-8"></div>
          
          <h3 class="text-lg font-bold text-gray-800 border-b border-gray-200 pb-2 mb-4">幾何特性</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left border-collapse">
              <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                <tr>
                  <th class="px-4 py-3 border border-gray-200">項目</th>
                  <th class="px-4 py-3 border border-gray-200">単位長さ</th>
                  <th class="px-4 py-3 border border-gray-200">コード長</th>
                </tr>
              </thead>
              <tbody id="resultBody" class="text-gray-700">
                <tr><td colspan="3" class="px-4 py-8 text-center text-gray-400 italic">計算実行待ち...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// --- 初期化 ---
document.addEventListener('DOMContentLoaded', () => {
    // 初回はNACA2412を自動生成して表示
    // generateNACA();
});

// --- NACA 4-Digit Generator ---
function generateNACA(isSilent = false) {
    const codeInput = document.getElementById('nacaCode');
    // 要素がない場合や値が取れない場合のガード
    const code = codeInput ? codeInput.value : "";
    
    const numPoints = parseInt(document.getElementById('numPoints').value) || 100;
    
    const isClosed = document.getElementById('closeTE').checked;
    const coeff4 = isClosed ? 0.1036 : 0.1015;

    // バリデーションチェック
    if (!/^\d{4}$/.test(code)) {
        // サイレントモードでなければアラートを出す
        if (!isSilent) {
            alert("NACAコードは4桁の数字で入力してください (例: 2412)");
        }
        // 入力が不正なら、トグル操作時でもここで処理を中断する
        return;
    }

    // パラメータ解析
    const m = parseInt(code[0]) / 100.0;
    const p = parseInt(code[1]) / 10.0;
    const t = parseInt(code.slice(2)) / 100.0;

    const upper = [];
    const lower = [];

    for (let i = 0; i <= numPoints; i++) {
        const beta = (i / numPoints) * Math.PI;
        const x = 0.5 * (1.0 - Math.cos(beta));

        // 厚み分布 yt
        const yt = 5 * t * (
            0.2969 * Math.sqrt(x) -
            0.1260 * x -
            0.3516 * x**2 +
            0.2843 * x**3 -
            coeff4 * x**4  // ★変更: 変数 coeff4 を使用
        );

        // キャンバーライン yc と 勾配 dyc/dx
        let yc = 0;
        let dyc_dx = 0;

        if (m === 0) {
            yc = 0;
            dyc_dx = 0;
        } else {
            if (x < p) {
                yc = (m / (p * p)) * (2 * p * x - x * x);
                dyc_dx = (2 * m / (p * p)) * (p - x);
            } else {
                yc = (m / ((1 - p) ** 2)) * ((1 - 2 * p) + 2 * p * x - x * x);
                dyc_dx = (2 * m / ((1 - p) ** 2)) * (p - x);
            }
        }

        const theta = Math.atan(dyc_dx);

        const xu = x - yt * Math.sin(theta);
        const yu = yc + yt * Math.cos(theta);
        
        const xl = x + yt * Math.sin(theta);
        const yl = yc - yt * Math.cos(theta);

        upper.push({x: xu, y: yu});
        lower.push({x: xl, y: yl});
    }

    let points = [];
    // 上面: TE -> LE
    for(let i = upper.length - 1; i >= 0; i--) {
        points.push(upper[i]);
    }
    // 下面: LE -> TE
    for(let i = 1; i < lower.length; i++) {
        points.push(lower[i]);
    }

    const text = points.map(pt => `${pt.x.toFixed(6)} ${pt.y.toFixed(6)}`).join('\n');
    document.getElementById('pointCloud').value = text;
    
    calculateProperties();
}

// --- 共通処理 (前回と同じロジック) ---

function parsePoints(text) {
    const lines = text.trim().split(/\n+/);
    const points = [];
    for (let line of lines) {
        const parts = line.trim().split(/[\s,]+/);
        if (parts.length >= 2) {
            const x = parseFloat(parts[0]);
            const y = parseFloat(parts[1]);
            if (!isNaN(x) && !isNaN(y)) points.push({ x, y });
        }
    }
    return points;
}

function normalizeAndUpdate() {
    let points = parsePoints(document.getElementById('pointCloud').value);
    if (points.length < 3) { alert("データ不足"); return; }

    // 1. 最も左にある点(min x)を探して前縁(LE)とする
    let minX = Infinity;
    let leIdx = -1;
    points.forEach((p, i) => {
        if (p.x < minX) { minX = p.x; leIdx = i; }
    });

    // 2. シフト (LEを原点 0,0 へ)
    const leP = { ...points[leIdx] };
    points = points.map(p => ({ x: p.x - leP.x, y: p.y - leP.y }));

    const first = points[0];
    const last = points[points.length - 1];

    let targetX, targetY;

    //始点と終点の中点をターゲットにする
    targetX = (first.x + last.x) / 2;
    targetY = (first.y + last.y) / 2;

    // ターゲット（中点）がX軸上に来るように角度を計算
    const angle = Math.atan2(targetY, targetX);
    const cosA = Math.cos(-angle), sinA = Math.sin(-angle);

    // 回転実行
    points = points.map(p => ({ 
        x: p.x * cosA - p.y * sinA, 
        y: p.x * sinA + p.y * cosA 
    }));

    // --- スケーリングロジックの変更 ---
    
    // 回転後の「新しい最大X」をコード長として正規化する
    // (中点基準で回すと、角の部分がX=1.0を超える可能性があるため再計測する)
    let newMaxX = -Infinity;
    points.forEach(p => { if (p.x > newMaxX) newMaxX = p.x; });

    if (newMaxX !== 0) {
        points = points.map(p => ({ x: p.x / newMaxX, y: p.y / newMaxX }));
    }

    document.getElementById('pointCloud').value = points.map(p => `${p.x.toFixed(6)}\t${p.y.toFixed(6)}`).join("\n");
    calculateProperties();
}

function calculateProperties() {
    const text = document.getElementById('pointCloud').value;
    const chordLen = parseFloat(document.getElementById('chordLength').value) || 1000;
    let points = parsePoints(text);
    if (points.length < 3) return;

    // 閉合
    const first = points[0], last = points[points.length - 1];
    if (Math.sqrt((first.x - last.x)**2 + (first.y - last.y)**2) > 1e-4) points.push({ x: first.x, y: first.y });

    let area = 0, Sx = 0, Sy = 0, Ixx_raw = 0, Iyy_raw = 0, perimeter = 0;
    for (let i = 0; i < points.length - 1; i++) {
        const p1 = points[i], p2 = points[i+1];
        const cross = (p1.x * p2.y - p2.x * p1.y);
        area += cross;
        Sy += (p1.x + p2.x) * cross;
        Sx += (p1.y + p2.y) * cross;
        Ixx_raw += (p1.y**2 + p1.y * p2.y + p2.y**2) * cross;
        Iyy_raw += (p1.x**2 + p1.x * p2.x + p2.x**2) * cross;
        perimeter += Math.sqrt((p2.x - p1.x)**2 + (p2.y - p1.y)**2);
    }
    area = Math.abs(area * 0.5);
    const cx = (Sy / 6) / (area * Math.sign(area) || 1); 
    const cy = (Sx / 6) / (area * Math.sign(area) || 1);
    const Ixx = Math.abs(Ixx_raw / 12) - area * cy * cy;
    
    // 簡易最大翼厚
    let minY = Infinity, maxY = -Infinity;
    points.forEach(p => { if (p.y < minY) minY = p.y; if (p.y > maxY) maxY = p.y; });
    const maxThick = maxY - minY;

    document.getElementById('resultBody').innerHTML = `
        ${createRow("断面積", area, area * (chordLen**2), "mm²")}
        ${createRow("周長", perimeter, perimeter * chordLen, "mm")}
        ${createRow("重心 X", cx, cx * chordLen, "mm")}
        ${createRow("重心 Y", cy, cy * chordLen, "mm")}
        ${createRow("最大翼厚", maxThick, maxThick * chordLen, "mm")}
        ${createRow("断面二次モーメント Ixx", Ixx, Ixx * (chordLen**4), "mm⁴")}
    `;

    // グラフ更新
    const trace = {
        x: points.map(p => p.x), y: points.map(p => p.y),
        mode: 'lines', name: 'Airfoil',
        line: {color: '#08206b', width: 2}, fill: 'toself', fillcolor: 'rgba(8, 32, 107, 0.1)'
    };
    const pLayout = {
        title: { text: `Airfoil Shape (Chord: ${chordLen}mm)`, font: { size: 14 } },
        xaxis: { title: 'x/c', zeroline: true },
        yaxis: { title: 'y/c', scaleanchor: "x", scaleratio: 1 },
        margin: { t: 40, r: 20, b: 40, l: 50 },
        showlegend: false,
        paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)'
    };
    Plotly.react('airfoilPlot', [trace], pLayout, { responsive: true, displayModeBar: false });
}

function createRow(label, nV, rV, unit) {
    let dV = rV.toLocaleString('en-US', { maximumFractionDigits: 2 });
    if (Math.abs(rV) > 100000 || (Math.abs(rV) < 0.01 && rV !== 0)) dV = rV.toExponential(3);
    return `<tr class="border-b border-gray-100 hover:bg-gray-50"><td class="px-4 py-2 font-medium">${label}</td><td class="px-4 py-2 font-mono text-gray-600">${nV.toExponential(4)}</td><td class="px-4 py-2 font-mono font-bold text-[var(--color-brand)]">${dV} <span class="text-xs text-gray-400 font-normal ml-1">${unit}</span></td></tr>`;
}
</script>

    </div>

    
    <div class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8">
        
        <div class="mt-8">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">
            How to Use
        </h3>
        
        <div class="rounded-lg bg-[var(--color-bg-callout)] p-5 border border-gray-200">
            <div class="text-sm text-gray-600 prose prose-sm max-w-none [&_ol]:list-decimal [&_ol]:pl-5 [&_li]:marker:text-[var(--color-brand)] [&_li]:pl-1">
            <ol>
  <li>まず <strong>コード長</strong> と <strong>点群データ</strong> を入力してください。</li>
  <li>NACA4桁翼型であれば、コードを入力して「生成」ボタンから自動生成することが可能です。</li>
  <li>もし正規化されていない場合は、正規化ボタンを押してください。</li>
  <li>「計算・描画実行」ボタンを押すと、右側（スマホの場合は下側）に形状と解析結果が表示されます。</li>
</ol>

            </div>
        </div>
        </div>
        
    </div>

  </main>

    </main>

    <!-- <footer>
  <div class="footer">
    <div class="copy">&copy;2024 九大ロボ技</div>
  </div>
</footer> -->

<footer class="bg-[#9191a7] mt-4">
  <div class="mx-auto p-2 text-center" style="font-family: var(--font-lubri)">
    <p>© 2025 やぱのブログ</p>
  </div>
</footer>

  </body>
</html>